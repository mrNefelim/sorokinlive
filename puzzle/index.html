<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puzzle Game</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="top-controls">
            <button class="back-button">Назад</button>
            <div class="timer">Время: 0:00</div>
        </div>
        <div class="game-controls">
            <div class="difficulty-controls">
                <label for="difficulty">Сложность:</label>
                <select id="difficulty">
                    <option value="3">3x3</option>
                    <option value="4">4x4</option>
                    <option value="5">5x5</option>
                </select>
            </div>
            <button class="start-button">Начать игру</button>
        </div>
        <div class="images-grid"></div>
        <div class="puzzle-container"></div>
    </div>
    <script>document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector(".images-grid"),t=document.querySelector(".start-button"),r=document.querySelector(".back-button"),n=document.querySelector(".timer"),s=document.querySelector(".puzzle-container"),o=document.querySelector("#difficulty"),a=document.querySelector(".difficulty-controls");let l,c=null,i=!1,d=0,u=null,p=0,v=0;function m(e){e.target.classList.add("dragging"),e.dataTransfer.setData("text/plain",e.target.dataset.correctPosition),e.dataTransfer.effectAllowed="move"}function g(e){e.target.classList.remove("dragging")}function f(e){e.preventDefault(),e.dataTransfer.dropEffect="move",e.currentTarget.classList.add("drag-over")}function y(e){e.preventDefault(),e.currentTarget.classList.remove("drag-over")}function L(e){e.preventDefault();const t=e.dataTransfer.getData("text/plain"),r=e.currentTarget,n=Array.from(s.children).find((e=>e.querySelector(".puzzle-piece")?.dataset.correctPosition===t));if(!n||!r)return;const o=n.querySelector(".puzzle-piece"),a=r.querySelector(".puzzle-piece");o&&(a&&n.appendChild(a),r.appendChild(o),r.classList.remove("drag-over"),S())}function z(e){if(e.preventDefault(),u=e.target.closest(".puzzle-piece"),!u)return;const t=e.touches[0];p=t.clientX,v=t.clientY,u.style.zIndex="1000",u.classList.add("dragging")}function E(e){if(e.preventDefault(),!u)return;const t=e.touches[0],r=t.clientX-p,n=t.clientY-v;u.style.transform=`translate(${r}px, ${n}px)`;const s=u.style.display;u.style.display="none";const o=document.elementFromPoint(t.clientX,t.clientY);u.style.display=s;const a=o?.closest(".puzzle-slot");document.querySelectorAll(".puzzle-slot").forEach((e=>{e.classList.remove("drag-over")})),a&&a!==u.parentElement&&a.classList.add("drag-over")}function h(e){if(!u)return;const t=e.changedTouches[0],r=u.style.display;u.style.display="none";const n=document.elementFromPoint(t.clientX,t.clientY);u.style.display=r;const s=n?.closest(".puzzle-slot");if(u.style.transform="",u.style.zIndex="",u.classList.remove("dragging"),s&&s!==u.parentElement){const e=s.querySelector(".puzzle-piece"),t=u.parentElement;e&&t.appendChild(e),s.appendChild(u),S()}u=null,document.querySelectorAll(".puzzle-slot").forEach((e=>{e.classList.remove("drag-over")}))}function S(){Array.from(s.children).every((e=>{const t=e.querySelector(".puzzle-piece");return t&&parseInt(t.dataset.correctPosition)===parseInt(e.dataset.correctPosition)}))&&(clearInterval(l),setTimeout((()=>{alert("Поздравляем! Вы собрали паззл!"),q()}),100))}function q(){s.querySelectorAll(".puzzle-slot").forEach((e=>{const t=e.querySelector(".puzzle-piece");t&&(t.removeEventListener("dragstart",m),t.removeEventListener("dragend",g),t.removeEventListener("touchstart",z),t.removeEventListener("touchmove",E),t.removeEventListener("touchend",h)),e.removeEventListener("dragover",f),e.removeEventListener("dragleave",y),e.removeEventListener("drop",L)})),i=!1,c=null,d=0,clearInterval(l),t.style.display="block",r.classList.remove("visible"),n.classList.add("hidden"),e.style.display="grid",a.style.display="flex",s.classList.remove("visible"),document.querySelectorAll(".image-preview").forEach((e=>e.classList.remove("selected"))),t.disabled=!0}["images/cropped/puzzle1.jpg","images/cropped/puzzle2.jpg","images/cropped/puzzle3.jpg","images/cropped/puzzle4.jpg","images/cropped/puzzle5.jpg","images/cropped/puzzle6.jpg"].forEach((r=>{const n=document.createElement("div");n.className="image-preview",n.style.backgroundImage=`url(${r})`,n.addEventListener("click",(()=>function(e,r){document.querySelectorAll(".image-preview").forEach((e=>e.classList.remove("selected"))),r.classList.add("selected"),c=e,t.disabled=!1}(r,n))),e.appendChild(n)})),t.addEventListener("click",(function(){if(!c)return;i=!0,t.style.display="none",r.classList.add("visible"),n.classList.remove("hidden"),e.style.display="none",a.style.display="none",s.classList.add("visible");const u=parseInt(o.value);s.style.gridTemplateColumns=`repeat(${u}, 1fr)`,function(e,t){s.querySelectorAll(".puzzle-slot").forEach((e=>{const t=e.querySelector(".puzzle-piece");t&&(t.removeEventListener("dragstart",m),t.removeEventListener("dragend",g),t.removeEventListener("touchstart",z),t.removeEventListener("touchmove",E),t.removeEventListener("touchend",h)),e.removeEventListener("dragover",f),e.removeEventListener("dragleave",y),e.removeEventListener("drop",L)})),s.innerHTML="",s.style.gridTemplateColumns=`repeat(${t}, 1fr)`;const r=t*t;for(let n=0;n<r;n++){const r=document.createElement("div");r.className="puzzle-slot",r.dataset.correctPosition=n;const o=document.createElement("div");o.className="puzzle-piece",o.style.backgroundImage=`url(${e})`,o.dataset.correctPosition=n;const a=n%t*100,l=100*Math.floor(n/t);o.style.backgroundPosition=`-${a}% -${l}%`,o.draggable=!0,o.addEventListener("touchstart",z,{passive:!1}),o.addEventListener("touchmove",E,{passive:!1}),o.addEventListener("touchend",h),o.addEventListener("dragstart",m),o.addEventListener("dragend",g),r.addEventListener("dragover",f),r.addEventListener("dragleave",y),r.addEventListener("drop",L),r.appendChild(o),s.appendChild(r)}}(c,u),setTimeout((()=>{!function(){const e=Array.from(s.children).map((e=>e.firstChild));e.forEach((e=>e.classList.add("shuffling")));let t=e.length;const r=()=>{if(t<=0)return void e.forEach((e=>e.classList.remove("shuffling")));t--;const n=Math.floor(Math.random()*t),s=e[t].parentElement,o=e[n].parentElement;requestAnimationFrame((()=>{s.appendChild(e[n]),o.appendChild(e[t]),setTimeout(r,100)}))};r()}(),l=setInterval((()=>{d++;const e=Math.floor(d/60),t=d%60;n.textContent=`Время: ${e}:${t.toString().padStart(2,"0")}`}),1e3)}),500)})),r.addEventListener("click",q)}));</script>
</body>
</html> 